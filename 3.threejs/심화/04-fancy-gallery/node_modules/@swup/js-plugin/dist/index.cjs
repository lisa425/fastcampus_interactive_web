var t=require("@swup/plugin"),n=require("swup");function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=/*#__PURE__*/i(t);const r={from:"(.*)",to:"(.*)",out:t=>t(),in:t=>t()};module.exports=class extends o.default{constructor(t){super();const i=this,o=this;var s;this.name="SwupJsPlugin",this.requires={swup:">=4"},this.defaults={animations:[],matchOptions:{}},this.options=void 0,this.animations=[],this.awaitOutAnimation=function(t,n){let{skip:i}=n;try{return i?Promise.resolve():Promise.resolve(o.findAndRunAnimation(t,"out")).then(function(){})}catch(t){return Promise.reject(t)}},this.awaitInAnimation=function(t,n){let{skip:o}=n;try{return o?Promise.resolve():Promise.resolve(i.findAndRunAnimation(t,"in")).then(function(){})}catch(t){return Promise.reject(t)}},Array.isArray(t)&&(t={animations:t}),this.options={...this.defaults,...t},this.options.animations.push(r),this.animations=(s=this.options.matchOptions,this.options.animations.map(t=>function(t,i){const o=n.matchPath(t.from,i),r=n.matchPath(t.to,i);return{...t,matchesFrom:o,matchesTo:r}}(t,s)))}mount(){this.replace("animation:out:await",this.awaitOutAnimation,{priority:-1}),this.replace("animation:in:await",this.awaitInAnimation,{priority:-1})}findAndRunAnimation(t,i){try{const o=function(t,n){return function(t,n,i,o){let r=0;const s=t.reduceRight((t,s)=>{const e=function(t,n,i,o){let r=0;const s=t.matchesFrom(n);return s&&(r+=1),t.matchesTo(i)&&(r+=1),s&&t.to===o&&(r+=2),r}(s,n,i,o);return e>=r?(r=e,s):t},null);return s}(t,n.from.url,n.to.url,n.animation.name)}(this.animations,t),r=function(){if(o){const r=function(t,n,i){const o=t.matchesFrom(n.from.url),r=t.matchesTo(n.to.url);return{visit:n,direction:i,from:{url:n.from.url,pattern:t.from,params:o?o.params:{}},to:{url:n.to.url,pattern:t.to,params:r?r.params:{}}}}(o,t,i);return Promise.resolve(function(t,i){const{direction:o}=i,r=t[o];return r?new Promise(t=>{const o=r(()=>t(),i);n.isPromise(o)&&o.then(t)}):(console.warn(`Missing animation function for '${o}' phase`),Promise.resolve())}(o,r)).then(function(){})}}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(t){return Promise.reject(t)}}};
//# sourceMappingURL=index.cjs.map
