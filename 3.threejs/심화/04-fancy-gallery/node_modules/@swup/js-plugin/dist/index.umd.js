!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t||self).SwupJsPlugin=n()}(this,function(){function t(){return t=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},t.apply(this,arguments)}const n=t=>String(t).split(".").map(t=>String(parseInt(t||"0",10))).concat(["0","0"]).slice(0,3).join(".");class e{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(t=>t()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([t,e])=>{if(!function(t,e,r){const i=function(t,n){var e;if("swup"===t)return null!=(e=n.version)?e:"";{var r;const e=n.findPlugin(t);return null!=(r=null==e?void 0:e.version)?r:""}}(t,r);return!!i&&((t,e)=>e.every(e=>{const[,r,i]=e.match(/^([\D]+)?(.*)$/)||[];var o,a;return((t,n)=>{const e={"":t=>0===t,">":t=>t>0,">=":t=>t>=0,"<":t=>t<0,"<=":t=>t<=0};return(e[n]||e[""])(t)})((a=i,o=n(o=t),a=n(a),o.localeCompare(a,void 0,{numeric:!0})),r||">=")}))(i,e)}(t,e=Array.isArray(e)?e:[e],this.swup)){const n=`${t} ${e.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${n}`)}}),!0}on(t,n,e={}){var r;n=!(r=n).name.startsWith("bound ")||r.hasOwnProperty("prototype")?n.bind(this):n;const i=this.swup.hooks.on(t,n,e);return this.handlersToUnregister.push(i),i}once(n,e,r={}){return this.on(n,e,t({},r,{once:!0}))}before(n,e,r={}){return this.on(n,e,t({},r,{before:!0}))}replace(n,e,r={}){return this.on(n,e,t({},r,{replace:!0}))}off(t,n){return this.swup.hooks.off(t,n)}}function r(t,n){var e=[];return function(t,n,e){void 0===e&&(e={});var r=e.decode,i=void 0===r?function(t){return t}:r;return function(e){var r=t.exec(e);if(!r)return!1;for(var o=r[0],a=r.index,s=Object.create(null),c=function(t){if(void 0===r[t])return"continue";var e=n[t-1];s[e.name]="*"===e.modifier||"+"===e.modifier?r[t].split(e.prefix+e.suffix).map(function(t){return i(t,e)}):i(r[t],e)},u=1;u<r.length;u++)c(u);return{path:o,index:a,params:s}}}(a(t,e,n),e,n)}function i(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function o(t){return t&&t.sensitive?"":"i"}function a(t,n,e){return t instanceof RegExp?function(t,n){if(!n)return t;for(var e=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,i=e.exec(t.source);i;)n.push({name:i[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),i=e.exec(t.source);return t}(t,n):Array.isArray(t)?function(t,n,e){var r=t.map(function(t){return a(t,n,e).source});return new RegExp("(?:".concat(r.join("|"),")"),o(e))}(t,n,e):function(t,n,e){return function(t,n,e){void 0===e&&(e={});for(var r=e.strict,a=void 0!==r&&r,s=e.start,c=void 0===s||s,u=e.end,f=void 0===u||u,p=e.encode,h=void 0===p?function(t){return t}:p,l=e.delimiter,m=void 0===l?"/#?":l,d=e.endsWith,v="[".concat(i(void 0===d?"":d),"]|$"),y="[".concat(i(m),"]"),g=c?"^":"",w=0,E=t;w<E.length;w++){var x=E[w];if("string"==typeof x)g+=i(h(x));else{var A=i(h(x.prefix)),P=i(h(x.suffix));if(x.pattern)if(n&&n.push(x),A||P)if("+"===x.modifier||"*"===x.modifier){var T="*"===x.modifier?"?":"";g+="(?:".concat(A,"((?:").concat(x.pattern,")(?:").concat(P).concat(A,"(?:").concat(x.pattern,"))*)").concat(P,")").concat(T)}else g+="(?:".concat(A,"(").concat(x.pattern,")").concat(P,")").concat(x.modifier);else g+="+"===x.modifier||"*"===x.modifier?"((?:".concat(x.pattern,")").concat(x.modifier,")"):"(".concat(x.pattern,")").concat(x.modifier);else g+="(?:".concat(A).concat(P,")").concat(x.modifier)}}if(f)a||(g+="".concat(y,"?")),g+=e.endsWith?"(?=".concat(v,")"):"$";else{var O=t[t.length-1],R="string"==typeof O?y.indexOf(O[O.length-1])>-1:void 0===O;a||(g+="(?:".concat(y,"(?=").concat(v,"))?")),R||(g+="(?=".concat(y,"|").concat(v,")"))}return new RegExp(g,o(e))}(function(t,n){void 0===n&&(n={});for(var e=function(t){for(var n=[],e=0;e<t.length;){var r=t[e];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)n.push({type:"CHAR",index:e,value:t[e++]});else{var i=1,o="";if("?"===t[s=e+1])throw new TypeError('Pattern cannot start with "?" at '.concat(s));for(;s<t.length;)if("\\"!==t[s]){if(")"===t[s]){if(0==--i){s++;break}}else if("("===t[s]&&(i++,"?"!==t[s+1]))throw new TypeError("Capturing groups are not allowed at ".concat(s));o+=t[s++]}else o+=t[s++]+t[s++];if(i)throw new TypeError("Unbalanced pattern at ".concat(e));if(!o)throw new TypeError("Missing pattern at ".concat(e));n.push({type:"PATTERN",index:e,value:o}),e=s}else{for(var a="",s=e+1;s<t.length;){var c=t.charCodeAt(s);if(!(c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||95===c))break;a+=t[s++]}if(!a)throw new TypeError("Missing parameter name at ".concat(e));n.push({type:"NAME",index:e,value:a}),e=s}else n.push({type:"CLOSE",index:e,value:t[e++]});else n.push({type:"OPEN",index:e,value:t[e++]});else n.push({type:"ESCAPED_CHAR",index:e++,value:t[e++]});else n.push({type:"MODIFIER",index:e,value:t[e++]})}return n.push({type:"END",index:e,value:""}),n}(t),r=n.prefixes,o=void 0===r?"./":r,a="[^".concat(i(n.delimiter||"/#?"),"]+?"),s=[],c=0,u=0,f="",p=function(t){if(u<e.length&&e[u].type===t)return e[u++].value},h=function(t){var n=p(t);if(void 0!==n)return n;var r=e[u],i=r.index;throw new TypeError("Unexpected ".concat(r.type," at ").concat(i,", expected ").concat(t))},l=function(){for(var t,n="";t=p("CHAR")||p("ESCAPED_CHAR");)n+=t;return n};u<e.length;){var m=p("CHAR"),d=p("NAME"),v=p("PATTERN");if(d||v)-1===o.indexOf(g=m||"")&&(f+=g,g=""),f&&(s.push(f),f=""),s.push({name:d||c++,prefix:g,suffix:"",pattern:v||a,modifier:p("MODIFIER")||""});else{var y=m||p("ESCAPED_CHAR");if(y)f+=y;else if(f&&(s.push(f),f=""),p("OPEN")){var g=l(),w=p("NAME")||"",E=p("PATTERN")||"",x=l();h("CLOSE"),s.push({name:w||(E?c++:""),pattern:w&&!E?a:E,prefix:g,suffix:x,modifier:p("MODIFIER")||""})}else h("END")}}return s}(t,e),n,e)}(t,n,e)}const s=(t,n)=>{try{return r(t,n)}catch(n){throw new Error(`[swup] Error parsing path "${String(t)}":\n${String(n)}`)}},c={from:"(.*)",to:"(.*)",out:t=>t(),in:t=>t()};return class extends e{constructor(t){super();const n=this,e=this;var r;this.name="SwupJsPlugin",this.requires={swup:">=4"},this.defaults={animations:[],matchOptions:{}},this.options=void 0,this.animations=[],this.awaitOutAnimation=function(t,n){let{skip:r}=n;try{return r?Promise.resolve():Promise.resolve(e.findAndRunAnimation(t,"out")).then(function(){})}catch(t){return Promise.reject(t)}},this.awaitInAnimation=function(t,e){let{skip:r}=e;try{return r?Promise.resolve():Promise.resolve(n.findAndRunAnimation(t,"in")).then(function(){})}catch(t){return Promise.reject(t)}},Array.isArray(t)&&(t={animations:t}),this.options={...this.defaults,...t},this.options.animations.push(c),this.animations=(r=this.options.matchOptions,this.options.animations.map(t=>function(t,n){const e=s(t.from,n),r=s(t.to,n);return{...t,matchesFrom:e,matchesTo:r}}(t,r)))}mount(){this.replace("animation:out:await",this.awaitOutAnimation,{priority:-1}),this.replace("animation:in:await",this.awaitInAnimation,{priority:-1})}findAndRunAnimation(t,n){try{const e=function(t,n){return function(t,n,e,r){let i=0;const o=t.reduceRight((t,o)=>{const a=function(t,n,e,r){let i=0;const o=t.matchesFrom(n);return o&&(i+=1),t.matchesTo(e)&&(i+=1),o&&t.to===r&&(i+=2),i}(o,n,e,r);return a>=i?(i=a,o):t},null);return o}(t,n.from.url,n.to.url,n.animation.name)}(this.animations,t),r=function(){if(e){const r=function(t,n,e){const r=t.matchesFrom(n.from.url),i=t.matchesTo(n.to.url);return{visit:n,direction:e,from:{url:n.from.url,pattern:t.from,params:r?r.params:{}},to:{url:n.to.url,pattern:t.to,params:i?i.params:{}}}}(e,t,n);return Promise.resolve(function(t,n){const{direction:e}=n,r=t[e];return r?new Promise(t=>{const e=r(()=>t(),n);var i;!(i=e)||"object"!=typeof i&&"function"!=typeof i||"function"!=typeof i.then||e.then(t)}):(console.warn(`Missing animation function for '${e}' phase`),Promise.resolve())}(e,r)).then(function(){})}}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(t){return Promise.reject(t)}}}});
//# sourceMappingURL=index.umd.js.map
